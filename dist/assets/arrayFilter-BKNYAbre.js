import{u as N}from"./dataUtils-XrCV_Bny.js";import{g as d}from"./pathUtils-D7aoCHLF.js";import"./index-DCMSPJRD.js";function y(e,s="iso"){if(!e)return null;try{switch(s){case"iso":case"iso-datetime":const l=new Date(e);return isNaN(l.getTime())?null:l;case"br":if(typeof e!="string")return null;const c=e.split("/");if(c.length!==3)return null;const[u,t,r]=c,i=new Date(`${r}-${t.padStart(2,"0")}-${u.padStart(2,"0")}`);return isNaN(i.getTime())?null:i;case"us":if(typeof e!="string")return null;const n=e.split("/");if(n.length!==3)return null;const[f,g,o]=n,a=new Date(`${o}-${f.padStart(2,"0")}-${g.padStart(2,"0")}`);return isNaN(a.getTime())?null:a;case"timestamp":const m=Number(e);if(isNaN(m))return null;const p=new Date(m);return isNaN(p.getTime())?null:p;default:const h=new Date(e);return isNaN(h.getTime())?null:h}}catch{return null}}function w(e,s,l,c="auto",u="iso"){let t=e,r=s;if(c==="date"){const i=y(e,u),n=y(s,u);if(!i||!n)return!1;t=i.getTime(),r=n.getTime()}else if(c==="number"){if(t=Number(e),r=Number(s),isNaN(t)||isNaN(r))return!1}else if(c==="boolean"){const i=n=>{if(typeof n=="boolean")return n;if(typeof n=="number")return n!==0;if(typeof n=="string"){const f=n.toLowerCase();return f==="true"||f==="yes"||f==="1"}return!!n};t=i(e),r=i(s)}else if(c==="string")t=String(e),r=String(s);else if(c==="auto"){const i=Number(e),n=Number(s);!isNaN(i)&&!isNaN(n)?(t=i,r=n):(t=String(e),r=String(s))}switch(l){case"equals":return t===r;case"notEquals":return t!==r;case"greaterThan":return t>r;case"lessThan":return t<r;case"greaterOrEqual":return t>=r;case"lessOrEqual":return t<=r;case"contains":return String(t).toLowerCase().includes(String(r).toLowerCase());case"startsWith":return String(t).toLowerCase().startsWith(String(r).toLowerCase());case"endsWith":return String(t).toLowerCase().endsWith(String(r).toLowerCase());default:return!0}}function T({nodeData:e,inputs:s}){var g;console.log("üîç Array Filter Execute:",{nodeData:e,inputs:s});let l=N(s["data-input"]);if(console.log("üì¶ Input data:",l),!Array.isArray(l))throw new Error("Input deve ser um array");const c=e.fieldMode||"selector";let u;if(c==="custom")u=e.customField;else{const o=e.selectedField;Array.isArray(o)&&o.length>0?u=o[0]:typeof o=="string"&&(u=o)}const t=e.operator||"equals";let r=s["exposed-value"]!==void 0?N(s["exposed-value"]):e.value;if((g=e.exposedFields)!=null&&g.value&&typeof r=="object"&&r!==null&&!Array.isArray(r)){const o=Object.values(r);o.length>0&&(r=o[0])}const i=e.comparisonType||"auto",n=e.dateFormat||"iso";if(console.log("‚öôÔ∏è Filter config:",{field:u,operator:t,compareValue:r,comparisonType:i,dateFormat:n}),t==="exists")return l.filter(o=>{const a=d(o,u);return a!=null});if(t==="notExists")return l.filter(o=>{const a=d(o,u);return a==null});const f=l.filter(o=>{const a=d(o,u);return a==null?!1:w(a,r,t,i,n)});return console.log("‚úÖ Filtered result:",f,`(${f.length} items)`),f}function C(e){const s=[];return(e.fieldMode||"selector")==="custom"?e.customField||s.push("Campo customField obrigat√≥rio no modo custom"):(!e.selectedField||Array.isArray(e.selectedField)&&e.selectedField.length===0)&&s.push("Sele√ß√£o de campo obrigat√≥ria"),e.operator||s.push('Campo "operator" obrigat√≥rio'),["equals","notEquals","greaterThan","lessThan","greaterOrEqual","lessOrEqual","contains","startsWith","endsWith"].includes(e.operator)&&!e.value&&s.push(`Operador "${e.operator}" requer um valor de compara√ß√£o`),{valid:s.length===0,errors:s}}export{T as execute,C as validate};
