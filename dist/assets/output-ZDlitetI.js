import{u as m}from"./index-CpYWmskZ.js";async function w(t,e,o){const{type:i,config:s}=e;if(i==="display")return t;if(i==="apiResponse")return{_isApiResponse:!0,data:t,config:s};const a={webhook:"/api/output/webhook",email:"/api/output/email",googleSheets:"/api/output/google-sheets",download:"/api/output/download"}[i];if(!a)throw new Error(`Unknown destination type: ${i}`);const d=o.baseUrl||"http://localhost:3001",l=o.token;if(!l)throw new Error("Missing authentication token for output operation");try{const r=await fetch(`${d}${a}`,{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify({data:t,config:s})});if(!r.ok){const u=await r.json().catch(()=>({message:"Output request failed"}));throw new Error(u.message||`Output failed with status ${r.status}`)}if(i==="download"){const u=await r.blob(),p=URL.createObjectURL(u),c=document.createElement("a");c.href=p;const f=s.filename||"output",g=s.format==="csv"?"csv":s.format==="excel"?"xlsx":"json";return c.download=`${f}.${g}`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(p),{success:!0,message:"File downloaded successfully"}}return await r.json()}catch(r){throw r}}const{unwrapData:h}=m;async function k({nodeData:t,inputs:e,context:o}){const i={};if(t.dynamicInputs&&t.dynamicInputs.length>0?t.dynamicInputs.forEach(n=>{const a=n.key;e[a]!==void 0&&(i[a]=h(e[a]))}):Object.keys(e).forEach(n=>{i[n]=h(e[n])}),!t.destination||t.destination==="display")return i;const s={type:t.destination,config:t.destinationConfig||{}};try{return await w(i,s,o.apiConfig)}catch(n){throw n}}function U(t){const e=[];t.destination||e.push("Destination é obrigatório");const o=t.destinationConfig||{};return t.destination==="webhook"&&(o.url?o.url.startsWith("http")||e.push("URL deve começar com http:// ou https://"):e.push("Webhook URL é obrigatória")),t.destination==="email"&&(o.to||e.push("Email destinatário é obrigatório")),t.destination==="googleSheets"&&(o.connectionId||e.push("Conexão Google é obrigatória"),o.spreadsheetUrl||e.push("URL da planilha é obrigatória")),{valid:e.length===0,errors:e}}export{k as execute,U as validate};
